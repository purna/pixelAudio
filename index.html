<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced SFX Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 5px;
            font-size: 2.2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 0.9em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .preset-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .preset-section {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
        }

        .preset-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preset-btn {
            width: 100%;
            padding: 10px;
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.2s;
            text-align: left;
        }

        .preset-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(5px);
        }

        .controls-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .control-section {
            background: #f8f9ff;
            padding: 18px;
            border-radius: 12px;
            border: 2px solid #e8ecff;
        }

        .section-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        label {
            font-weight: 600;
            color: #555;
            font-size: 0.85em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .value {
            color: #667eea;
            font-weight: 700;
            font-size: 0.9em;
        }

        input[type="range"] {
            width: 100%;
            height: 5px;
            border-radius: 3px;
            background: linear-gradient(to right, #667eea, #764ba2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            border: 2px solid #667eea;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: 2px solid #667eea;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .action-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            background: #f0f4ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .play-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .download-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        }

        .random-btn {
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            color: #333;
        }

        .random-btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .settings-bar {
            display: flex;
            gap: 20px;
            align-items: center;
            background: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            border: 2px solid #e8ecff;
            flex-wrap: wrap;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        .radio-group {
            display: flex;
            gap: 10px;
        }

        .radio-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.2s;
        }

        .radio-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .radio-btn:hover {
            border-color: #667eea;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .playing {
            animation: pulse 0.5s ease-in-out;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Advanced SFX Generator</h1>
        <p class="subtitle">Professional sound effects generator for games and UI</p>

        <div class="main-grid">
            <!-- Preset Panel -->
            <div class="preset-panel">
                <div class="preset-section">
                    <div class="preset-title">üé≤ Generator</div>
                    <button class="preset-btn" onclick="randomize()">üé≤ Random</button>
                </div>
                
                <div class="preset-section">
                    <div class="preset-title">üéÆ Game Sounds</div>
                    <button class="preset-btn" onclick="loadPreset('pickup')">üí∞ Pickup/Coin</button>
                    <button class="preset-btn" onclick="loadPreset('laser')">üî´ Laser/Shoot</button>
                    <button class="preset-btn" onclick="loadPreset('explosion')">üí• Explosion</button>
                    <button class="preset-btn" onclick="loadPreset('powerup')">‚ö° Powerup</button>
                    <button class="preset-btn" onclick="loadPreset('hit')">üí¢ Hit/Hurt</button>
                    <button class="preset-btn" onclick="loadPreset('jump')">ü¶ò Jump</button>
                </div>

                <div class="preset-section">
                    <div class="preset-title">üñ±Ô∏è UI Sounds</div>
                    <button class="preset-btn" onclick="loadPreset('click')">üëÜ Click</button>
                    <button class="preset-btn" onclick="loadPreset('blip')">üìç Blip/Select</button>
                    <button class="preset-btn" onclick="loadPreset('hover')">‚ú® Hover</button>
                </div>

                <div class="preset-section">
                    <div class="preset-title">üéπ Synth</div>
                    <button class="preset-btn" onclick="loadPreset('synth')">üéπ Synth</button>
                    <button class="preset-btn" onclick="loadPreset('tone')">üîä Tone</button>
                </div>
            </div>

            <!-- Controls Panel -->
            <div class="controls-panel">
                <!-- Envelope -->
                <div class="control-section">
                    <div class="section-title">üìä Envelope</div>
                    <div class="control-group">
                        <label>Attack <span class="value" id="attackVal">0.00s</span></label>
                        <input type="range" id="attack" min="0" max="0.5" value="0" step="0.001">
                    </div>
                    <div class="control-group">
                        <label>Sustain <span class="value" id="sustainVal">0.10s</span></label>
                        <input type="range" id="sustain" min="0" max="1" value="0.1" step="0.001">
                    </div>
                    <div class="control-group">
                        <label>Punch <span class="value" id="punchVal">0%</span></label>
                        <input type="range" id="punch" min="0" max="100" value="0" step="1">
                    </div>
                    <div class="control-group">
                        <label>Decay <span class="value" id="decayVal">0.20s</span></label>
                        <input type="range" id="decay" min="0" max="2" value="0.2" step="0.001">
                    </div>
                </div>

                <!-- Frequency -->
                <div class="control-section">
                    <div class="section-title">üéµ Frequency</div>
                    <div class="control-group">
                        <label>Start <span class="value" id="freqVal">440Hz</span></label>
                        <input type="range" id="frequency" min="20" max="2000" value="440" step="1">
                    </div>
                    <div class="control-group">
                        <label>Min Cutoff <span class="value" id="minFreqVal">0Hz</span></label>
                        <input type="range" id="minFreq" min="0" max="2000" value="0" step="1">
                    </div>
                    <div class="control-group">
                        <label>Slide <span class="value" id="slideVal">0</span></label>
                        <input type="range" id="slide" min="-1" max="1" value="0" step="0.01">
                    </div>
                    <div class="control-group">
                        <label>Delta Slide <span class="value" id="deltaSlideVal">0</span></label>
                        <input type="range" id="deltaSlide" min="-1" max="1" value="0" step="0.01">
                    </div>
                </div>

                <!-- Vibrato -->
                <div class="control-section">
                    <div class="section-title">„Ä∞Ô∏è Vibrato</div>
                    <div class="control-group checkbox-group">
                        <input type="checkbox" id="vibratoEnable">
                        <label style="margin: 0;">Enable Vibrato</label>
                    </div>
                    <div class="control-group">
                        <label>Depth <span class="value" id="vibratoDepthVal">0%</span></label>
                        <input type="range" id="vibratoDepth" min="0" max="100" value="0" step="1">
                    </div>
                    <div class="control-group">
                        <label>Speed <span class="value" id="vibratoSpeedVal">0Hz</span></label>
                        <input type="range" id="vibratoSpeed" min="0" max="50" value="0" step="0.1">
                    </div>
                </div>

                <!-- Arpeggiation -->
                <div class="control-section">
                    <div class="section-title">üéº Arpeggiation</div>
                    <div class="control-group checkbox-group">
                        <input type="checkbox" id="arpEnable">
                        <label style="margin: 0;">Enable Arpeggio</label>
                    </div>
                    <div class="control-group">
                        <label>Frequency Mult <span class="value" id="arpMultVal">x1.00</span></label>
                        <input type="range" id="arpMult" min="0.5" max="2" value="1" step="0.01">
                    </div>
                    <div class="control-group">
                        <label>Change Speed <span class="value" id="arpSpeedVal">0.00s</span></label>
                        <input type="range" id="arpSpeed" min="0" max="1" value="0" step="0.001">
                    </div>
                </div>

                <!-- Duty Cycle -->
                <div class="control-section">
                    <div class="section-title">‚ö° Duty Cycle</div>
                    <div class="control-group">
                        <label>Duty Cycle <span class="value" id="dutyVal">50%</span></label>
                        <input type="range" id="duty" min="0" max="100" value="50" step="1">
                    </div>
                    <div class="control-group">
                        <label>Sweep <span class="value" id="dutySweepVal">0%/s</span></label>
                        <input type="range" id="dutySweep" min="-100" max="100" value="0" step="1">
                    </div>
                </div>

                <!-- Filters -->
                <div class="control-section">
                    <div class="section-title">üéöÔ∏è Filters</div>
                    <div class="control-group checkbox-group">
                        <input type="checkbox" id="lpfEnable">
                        <label style="margin: 0;">Low-Pass Filter</label>
                    </div>
                    <div class="control-group">
                        <label>LP Cutoff <span class="value" id="lpfVal">22050Hz</span></label>
                        <input type="range" id="lpf" min="20" max="22050" value="22050" step="1">
                    </div>
                    <div class="control-group checkbox-group">
                        <input type="checkbox" id="hpfEnable">
                        <label style="margin: 0;">High-Pass Filter</label>
                    </div>
                    <div class="control-group">
                        <label>HP Cutoff <span class="value" id="hpfVal">0Hz</span></label>
                        <input type="range" id="hpf" min="0" max="5000" value="0" step="1">
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn play-btn" onclick="playSound()">‚ñ∂ Play Sound</button>
            <button class="btn random-btn" onclick="randomize()">üé≤ Randomize</button>
            <button class="btn download-btn" onclick="downloadSound()">‚¨á Download WAV</button>
        </div>

        <!-- Settings Bar -->
        <div class="settings-bar">
            <div class="setting-group">
                <span class="setting-label">Sample Rate:</span>
                <div class="radio-group">
                    <button class="radio-btn active" onclick="setSampleRate(44100)">44k</button>
                    <button class="radio-btn" onclick="setSampleRate(22050)">22k</button>
                    <button class="radio-btn" onclick="setSampleRate(11025)">11k</button>
                    <button class="radio-btn" onclick="setSampleRate(5512)">6k</button>
                </div>
            </div>
            <div class="setting-group">
                <span class="setting-label">Gain:</span>
                <input type="range" id="gain" min="-30" max="0" value="-10" step="0.1" style="width: 150px;">
                <span class="value" id="gainVal">-10.0 dB</span>
            </div>
        </div>
    </div>

    <script>
        let currentSampleRate = 44100;
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Update all value displays
        const sliders = {
            attack: 'attackVal', sustain: 'sustainVal', punch: 'punchVal', decay: 'decayVal',
            frequency: 'freqVal', minFreq: 'minFreqVal', slide: 'slideVal', deltaSlide: 'deltaSlideVal',
            vibratoDepth: 'vibratoDepthVal', vibratoSpeed: 'vibratoSpeedVal',
            arpMult: 'arpMultVal', arpSpeed: 'arpSpeedVal',
            duty: 'dutyVal', dutySweep: 'dutySweepVal',
            lpf: 'lpfVal', hpf: 'hpfVal', gain: 'gainVal'
        };

        for (let [slider, display] of Object.entries(sliders)) {
            document.getElementById(slider).addEventListener('input', updateDisplay);
        }

        function updateDisplay() {
            const s = getSettings();
            document.getElementById('attackVal').textContent = s.attack.toFixed(2) + 's';
            document.getElementById('sustainVal').textContent = s.sustain.toFixed(2) + 's';
            document.getElementById('punchVal').textContent = s.punch.toFixed(0) + '%';
            document.getElementById('decayVal').textContent = s.decay.toFixed(2) + 's';
            document.getElementById('freqVal').textContent = s.frequency.toFixed(0) + 'Hz';
            document.getElementById('minFreqVal').textContent = s.minFreq.toFixed(0) + 'Hz';
            document.getElementById('slideVal').textContent = s.slide.toFixed(2);
            document.getElementById('deltaSlideVal').textContent = s.deltaSlide.toFixed(2);
            document.getElementById('vibratoDepthVal').textContent = s.vibratoDepth.toFixed(0) + '%';
            document.getElementById('vibratoSpeedVal').textContent = s.vibratoSpeed.toFixed(1) + 'Hz';
            document.getElementById('arpMultVal').textContent = 'x' + s.arpMult.toFixed(2);
            document.getElementById('arpSpeedVal').textContent = s.arpSpeed.toFixed(3) + 's';
            document.getElementById('dutyVal').textContent = s.duty.toFixed(0) + '%';
            document.getElementById('dutySweepVal').textContent = s.dutySweep.toFixed(0) + '%/s';
            document.getElementById('lpfVal').textContent = s.lpf.toFixed(0) + 'Hz';
            document.getElementById('hpfVal').textContent = s.hpf.toFixed(0) + 'Hz';
            document.getElementById('gainVal').textContent = s.gain.toFixed(1) + ' dB';
        }

        function getSettings() {
            return {
                attack: parseFloat(document.getElementById('attack').value),
                sustain: parseFloat(document.getElementById('sustain').value),
                punch: parseFloat(document.getElementById('punch').value),
                decay: parseFloat(document.getElementById('decay').value),
                frequency: parseFloat(document.getElementById('frequency').value),
                minFreq: parseFloat(document.getElementById('minFreq').value),
                slide: parseFloat(document.getElementById('slide').value),
                deltaSlide: parseFloat(document.getElementById('deltaSlide').value),
                vibratoEnable: document.getElementById('vibratoEnable').checked,
                vibratoDepth: parseFloat(document.getElementById('vibratoDepth').value),
                vibratoSpeed: parseFloat(document.getElementById('vibratoSpeed').value),
                arpEnable: document.getElementById('arpEnable').checked,
                arpMult: parseFloat(document.getElementById('arpMult').value),
                arpSpeed: parseFloat(document.getElementById('arpSpeed').value),
                duty: parseFloat(document.getElementById('duty').value),
                dutySweep: parseFloat(document.getElementById('dutySweep').value),
                lpfEnable: document.getElementById('lpfEnable').checked,
                lpf: parseFloat(document.getElementById('lpf').value),
                hpfEnable: document.getElementById('hpfEnable').checked,
                hpf: parseFloat(document.getElementById('hpf').value),
                gain: parseFloat(document.getElementById('gain').value)
            };
        }

        function setSettings(settings) {
            for (let key in settings) {
                const el = document.getElementById(key);
                if (el) {
                    if (el.type === 'checkbox') {
                        el.checked = settings[key];
                    } else {
                        el.value = settings[key];
                    }
                }
            }
            updateDisplay();
        }

        function loadPreset(preset) {
            const presets = {
                pickup: { attack: 0, sustain: 0.075, punch: 48, decay: 0.053, frequency: 1243, minFreq: 3, slide: 0, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: true, arpMult: 1.18, arpSpeed: 0.085, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -10.93 },
                laser: { attack: 0, sustain: 0.15, punch: 0, decay: 0.3, frequency: 800, minFreq: 100, slide: -0.5, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 25, dutySweep: -20, lpfEnable: true, lpf: 8000, hpfEnable: false, hpf: 0, gain: -8 },
                explosion: { attack: 0, sustain: 0.5, punch: 80, decay: 0.8, frequency: 80, minFreq: 20, slide: -0.3, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: true, lpf: 1500, hpfEnable: true, hpf: 100, gain: -6 },
                powerup: { attack: 0, sustain: 0.2, punch: 0, decay: 0.4, frequency: 200, minFreq: 0, slide: 0.6, deltaSlide: 0.1, vibratoEnable: true, vibratoDepth: 30, vibratoSpeed: 10, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -12 },
                hit: { attack: 0, sustain: 0.05, punch: 100, decay: 0.15, frequency: 150, minFreq: 0, slide: -0.8, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: true, lpf: 3000, hpfEnable: true, hpf: 50, gain: -8 },
                jump: { attack: 0, sustain: 0.1, punch: 50, decay: 0.25, frequency: 400, minFreq: 0, slide: 0.4, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -10 },
                click: { attack: 0, sustain: 0.02, punch: 0, decay: 0.05, frequency: 1200, minFreq: 0, slide: 0, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -15 },
                blip: { attack: 0, sustain: 0.04, punch: 0, decay: 0.08, frequency: 800, minFreq: 0, slide: 0, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -12 },
                hover: { attack: 0.01, sustain: 0.06, punch: 0, decay: 0.05, frequency: 1000, minFreq: 0, slide: 0, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -18 },
                synth: { attack: 0.1, sustain: 0.3, punch: 0, decay: 0.2, frequency: 440, minFreq: 0, slide: 0, deltaSlide: 0, vibratoEnable: true, vibratoDepth: 20, vibratoSpeed: 5, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -10 },
                tone: { attack: 0.05, sustain: 0.5, punch: 0, decay: 0.1, frequency: 440, minFreq: 0, slide: 0, deltaSlide: 0, vibratoEnable: false, vibratoDepth: 0, vibratoSpeed: 0, arpEnable: false, arpMult: 1, arpSpeed: 0, duty: 50, dutySweep: 0, lpfEnable: false, lpf: 22050, hpfEnable: false, hpf: 0, gain: -12 }
            };
            
            if (presets[preset]) {
                setSettings(presets[preset]);
                playSound();
            }
        }

         function randomize() {
            const random = {
                attack: Math.random() * 0.2,
                sustain: Math.random() * 0.5,
                punch: Math.random() * 100,
                decay: Math.random() * 1,
                frequency: 100 + Math.random() * 1500,
                minFreq: Math.random() * 500,
                slide: (Math.random() - 0.5) * 2,
                deltaSlide: (Math.random() - 0.5) * 0.5,
                vibratoEnable: Math.random() > 0.7,
                vibratoDepth: Math.random() * 50,
                vibratoSpeed: Math.random() * 30,
                arpEnable: Math.random() > 0.7,
                arpMult: 0.5 + Math.random() * 1.5,
                arpSpeed: Math.random() * 0.5,
                duty: Math.random() * 100,
                dutySweep: (Math.random() - 0.5) * 100,
                lpfEnable: Math.random() > 0.5,
                lpf: 1000 + Math.random() * 21050,
                hpfEnable: Math.random() > 0.7,
                hpf: Math.random() * 1000,
                gain: -20 + Math.random() * 15
            };
            setSettings(random);
            playSound();
        }

        function setSampleRate(rate) {
            currentSampleRate = rate;
            document.querySelectorAll('.radio-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function generateSound() {
            const s = getSettings();
            const sampleRate = currentSampleRate;
            const duration = s.attack + s.sustain + s.decay;
            const samples = Math.floor(duration * sampleRate);
            const buffer = audioContext.createBuffer(1, samples, audioContext.sampleRate);
            const data = buffer.getChannelData(0);

            let phase = 0;
            let frequency = s.frequency;
            let slide = s.slide;
            let duty = s.duty / 100;
            let arpTime = 0;
            let arpMult = 1;

            const gainLinear = Math.pow(10, s.gain / 20);

            for (let i = 0; i < samples; i++) {
                const t = i / sampleRate;
                
                // Envelope
                let envelope = 0;
                if (t < s.attack) {
                    envelope = t / s.attack;
                } else if (t < s.attack + s.sustain) {
                    envelope = 1;
                    if (s.punch > 0) {
                        const punchT = (t - s.attack) / s.sustain;
                        envelope += (s.punch / 100) * (1 - punchT);
                    }
                } else {
                    const decayT = (t - s.attack - s.sustain) / s.decay;
                    envelope = 1 - decayT;
                }
                envelope = Math.max(0, Math.min(1, envelope));

                // Frequency slide
                slide += s.deltaSlide / sampleRate;
                frequency += slide;
                frequency = Math.max(s.minFreq, frequency);

                // Arpeggiation
                if (s.arpEnable && s.arpSpeed > 0) {
                    arpTime += 1 / sampleRate;
                    if (arpTime > s.arpSpeed) {
                        arpTime = 0;
                        arpMult = arpMult === 1 ? s.arpMult : 1;
                    }
                }

                let finalFreq = frequency * arpMult;

                // Vibrato
                if (s.vibratoEnable && s.vibratoDepth > 0) {
                    const vibrato = Math.sin(t * s.vibratoSpeed * Math.PI * 2) * (s.vibratoDepth / 100);
                    finalFreq *= 1 + vibrato;
                }

                // Generate square wave with duty cycle
                phase += (finalFreq / sampleRate) * Math.PI * 2;
                const square = (phase % (Math.PI * 2)) < (Math.PI * 2 * duty) ? 1 : -1;

                // Duty sweep
                duty += (s.dutySweep / 100) / sampleRate;
                duty = Math.max(0, Math.min(1, duty));

                data[i] = square * envelope * gainLinear;
            }

            // Apply filters
            if (s.lpfEnable) {
                applyLowPassFilter(data, s.lpf, sampleRate);
            }
            if (s.hpfEnable) {
                applyHighPassFilter(data, s.hpf, sampleRate);
            }

            return buffer;
        }

        function applyLowPassFilter(data, cutoff, sampleRate) {
            const RC = 1.0 / (cutoff * 2 * Math.PI);
            const dt = 1.0 / sampleRate;
            const alpha = dt / (RC + dt);
            
            for (let i = 1; i < data.length; i++) {
                data[i] = data[i - 1] + alpha * (data[i] - data[i - 1]);
            }
        }

        function applyHighPassFilter(data, cutoff, sampleRate) {
            const RC = 1.0 / (cutoff * 2 * Math.PI);
            const dt = 1.0 / sampleRate;
            const alpha = RC / (RC + dt);
            
            let y = 0;
            for (let i = 1; i < data.length; i++) {
                y = alpha * (y + data[i] - data[i - 1]);
                data[i] = y;
            }
        }

        function playSound() {
            const buffer = generateSound();
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start();

            // Visual feedback
            document.querySelector('.play-btn').classList.add('playing');
            setTimeout(() => {
                document.querySelector('.play-btn').classList.remove('playing');
            }, 500);
        }

        function downloadSound() {
            const buffer = generateSound();
            const wav = bufferToWave(buffer, buffer.length);
            const blob = new Blob([wav], { type: 'audio/wav' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sfx_' + Date.now() + '.wav';
            a.click();
            URL.revokeObjectURL(url);
        }

        function bufferToWave(buffer, len) {
            const numChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const format = 1; // PCM
            const bitDepth = 16;

            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;

            const data = new Int16Array(len * numChannels);
            const channelData = buffer.getChannelData(0);
            
            for (let i = 0; i < len; i++) {
                const sample = Math.max(-1, Math.min(1, channelData[i]));
                data[i] = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
            }

            const dataLength = data.length * bytesPerSample;
            const arrayBuffer = new ArrayBuffer(44 + dataLength);
            const view = new DataView(arrayBuffer);

            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataLength, true);
            writeString(view, 8, 'WAVE');

            // FMT sub-chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // fmt chunk size
            view.setUint16(20, format, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * blockAlign, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);

            // Data sub-chunk
            writeString(view, 36, 'data');
            view.setUint32(40, dataLength, true);

            // Write audio data
            let offset = 44;
            for (let i = 0; i < data.length; i++) {
                view.setInt16(offset, data[i], true);
                offset += 2;
            }

            return arrayBuffer;
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // Initialize
        updateDisplay();
    </script>
</body>
</html>
